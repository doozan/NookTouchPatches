diff --git a/services/.gitignore b/services/.gitignore
new file mode 100644
index 0000000..7664704
--- /dev/null
+++ b/services/.gitignore
@@ -0,0 +1 @@
+*.bak
\ No newline at end of file
diff --git a/services/com/android/server/status/BNGossamerQuickNavbar.smali b/services/com/android/server/status/BNGossamerQuickNavbar.smali
index 84f834d..9567d2e 100644
--- a/services/com/android/server/status/BNGossamerQuickNavbar.smali
+++ b/services/com/android/server/status/BNGossamerQuickNavbar.smali
@@ -464,6 +464,13 @@
     .line 80
     invoke-direct {p0}, Lcom/android/server/status/BNGossamerQuickNavbar;->setOnClickListeners()V
 
+### Mod Start
+###
+### Replace custom button icons, this should be called at the end of Init()
+###
+    invoke-virtual {p0}, Lcom/android/server/status/BNGossamerQuickNavbar;->replaceQuicknavIcons()V
+### Mod End
+
     .line 81
     return-void
 
@@ -507,6 +514,38 @@
     goto :goto_2c
 .end method
 
+### Mod Start
+###
+### Function to replace custom button icons
+### 
+
+.method public replaceQuicknavIcons()V
+    .registers 4
+
+    iget-object v0, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mContext:Landroid/content/Context;
+
+    iget-object v1, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mAppHome:Landroid/widget/ImageView;
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+
+    iget-object v1, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mAppLibrary:Landroid/widget/ImageView;
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+
+    iget-object v1, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mAppShop:Landroid/widget/ImageView;
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+
+    iget-object v1, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mAppSearch:Landroid/widget/ImageView;
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+
+    iget-object v1, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mGlowLight:Landroid/widget/ImageView;
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+
+    iget-object v1, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mAppSettings:Landroid/widget/ImageView;
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+
+	return-void
+.end method
+### Mod End
+
 .method public onClick(Landroid/view/View;)V
     .registers 12
     .parameter "v"
@@ -519,6 +558,32 @@
 
     move-result v4
 
+### Mod Start
+###
+### Override the quicknav buttons
+###
+### This should run near the start of onClick(), immediately after
+### getId() is read into v4
+###
+### if ( ModUtils.OnButtonClick( QuickNavbar.ctx, buttonId ) )
+###   mService.hideQuicknav()
+###   return;
+### }
+
+    iget-object v7, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->ctx:Landroid/content/Context;
+    invoke-static {v7, v4}, Lcom/android/server/status/ModUtils;->OnButtonClick(Landroid/content/Context;I)Z
+
+    move-result v0
+    if-eqz v0, :cond_mod1
+
+    iget-object v7, p0, Lcom/android/server/status/BNGossamerQuickNavbar;->mService:Lcom/android/server/status/StatusBarService;
+    invoke-virtual {v7, v9}, Lcom/android/server/status/StatusBarService;->hideQuicknav(Z)V
+
+    return-void
+
+    :cond_mod1
+### Mod End
+
     .line 98
     .local v4, id:I
     const/4 v0, 0x0
@@ -696,6 +761,22 @@
     .parameter "inStore"
 
     .prologue
+
+### Mod Start
+###
+###   If the shop button is overloaded, don't update the "in store" icon
+###
+    iget-object v0, p0, Lcom/android/server/status/StatusBarService;->mContext:Landroid/content/Context;
+    invoke-static {v0}, Lcom/android/server/status/ModUtils;->overrideShopButton(Landroid/content/Context;)Z
+
+    move-result v0
+    if-eqz v0, :cond_mod1
+
+	return-void
+
+    :cond_mod1
+### Mod End
+
     .line 171
     if-eqz p1, :cond_13
 
diff --git a/services/com/android/server/status/ModUtils$1.smali b/services/com/android/server/status/ModUtils$1.smali
new file mode 100644
index 0000000..1b574fe
--- /dev/null
+++ b/services/com/android/server/status/ModUtils$1.smali
@@ -0,0 +1,74 @@
+.class Lcom/android/server/status/ModUtils$1;
+.super Ljava/lang/Object;
+.source "ModUtils.java"
+
+# interfaces
+.implements Ljava/lang/Runnable;
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingMethod;
+    value = Lcom/android/server/status/ModUtils;->doAction(Landroid/content/Context;Ljava/lang/String;)Z
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x0
+    name = null
+.end annotation
+
+
+# instance fields
+.field private final synthetic val$action:Ljava/lang/String;
+
+.field private final synthetic val$context:Landroid/content/Context;
+
+
+# direct methods
+.method constructor <init>(Landroid/content/Context;Ljava/lang/String;)V
+    .registers 3
+    .parameter
+    .parameter
+
+    .prologue
+    .line 1
+    iput-object p1, p0, Lcom/android/server/status/ModUtils$1;->val$context:Landroid/content/Context;
+
+    iput-object p2, p0, Lcom/android/server/status/ModUtils$1;->val$action:Ljava/lang/String;
+
+    .line 291
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public run()V
+    .registers 4
+
+    .prologue
+    .line 293
+    iget-object v0, p0, Lcom/android/server/status/ModUtils$1;->val$context:Landroid/content/Context;
+
+    iget-object v1, p0, Lcom/android/server/status/ModUtils$1;->val$action:Ljava/lang/String;
+
+    const-string v2, "KEY:"
+
+    invoke-virtual {v2}, Ljava/lang/String;->length()I
+
+    move-result v2
+
+    invoke-virtual {v1, v2}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-static {v1}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v1
+
+    #calls: Lcom/android/server/status/ModUtils;->doKey(Landroid/content/Context;I)Z
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->access$0(Landroid/content/Context;I)Z
+
+    .line 294
+    return-void
+.end method
diff --git a/services/com/android/server/status/ModUtils.smali b/services/com/android/server/status/ModUtils.smali
new file mode 100644
index 0000000..98cfef4
--- /dev/null
+++ b/services/com/android/server/status/ModUtils.smali
@@ -0,0 +1,2009 @@
+.class public Lcom/android/server/status/ModUtils;
+.super Ljava/lang/Object;
+.source "ModUtils.java"
+
+
+# static fields
+.field private static final QUICKNAV_GLOWLIGHT:I = 0x102019b
+
+.field private static final QUICKNAV_HOME:I = 0x1020196
+
+.field private static final QUICKNAV_LIBRARY:I = 0x1020197
+
+.field private static final QUICKNAV_SEARCH:I = 0x1020199
+
+.field private static final QUICKNAV_SETTINGS:I = 0x102019a
+
+.field private static final QUICKNAV_SHOP:I = 0x1020198
+
+.field private static final STATUSBAR_BACK:I = 0x1020220
+
+.field private static final STATUSBAR_GLOWLIGHT:I = 0x1020225
+
+.field private static final STATUSBAR_MENU:I = 0x1020221
+
+.field private static final STATUSBAR_NOTIFY:I = 0x1020223
+
+.field private static final STATUSBAR_READNOW:I = 0x1020222
+
+.field private static final TAG:Ljava/lang/String; = "NookMod"
+
+.field private static final VERSION:Ljava/lang/String; = "0.2.1"
+
+
+# direct methods
+.method public constructor <init>()V
+    .registers 1
+
+    .prologue
+    .line 33
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+    return-void
+.end method
+
+.method public static OnButtonClick(Landroid/content/Context;I)Z
+    .registers 9
+    .parameter "context"
+    .parameter "id"
+
+    .prologue
+    const/4 v3, 0x0
+
+    .line 85
+    invoke-static {p1}, Lcom/android/server/status/ModUtils;->getButtonName(I)Ljava/lang/String;
+
+    move-result-object v1
+
+    .line 86
+    .local v1, buttonName:Ljava/lang/String;
+    if-eqz v1, :cond_d
+
+    invoke-virtual {v1}, Ljava/lang/String;->length()I
+
+    move-result v4
+
+    if-nez v4, :cond_22
+
+    .line 88
+    :cond_d
+    const-string v4, "NookMod"
+
+    new-instance v5, Ljava/lang/StringBuilder;
+
+    const-string v6, "OnButtonClick() Unknown button id = "
+
+    invoke-direct {v5, v6}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v5, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    move-result-object v5
+
+    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v5
+
+    invoke-static {v4, v5}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
+
+    .line 99
+    :cond_21
+    :goto_21
+    return v3
+
+    .line 93
+    :cond_22
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v2
+
+    .line 94
+    .local v2, resolver:Landroid/content/ContentResolver;
+    new-instance v4, Ljava/lang/StringBuilder;
+
+    const-string v5, "mod."
+
+    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v4, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v4
+
+    const-string v5, ".cmd"
+
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v4
+
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v4
+
+    invoke-static {v2, v4}, Landroid/provider/Settings$System;->getString(Landroid/content/ContentResolver;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+    .line 96
+    .local v0, action:Ljava/lang/String;
+    if-eqz v0, :cond_21
+
+    invoke-virtual {v0}, Ljava/lang/String;->length()I
+
+    move-result v4
+
+    if-eqz v4, :cond_21
+
+    .line 99
+    invoke-static {p0, v0}, Lcom/android/server/status/ModUtils;->doAction(Landroid/content/Context;Ljava/lang/String;)Z
+
+    move-result v3
+
+    goto :goto_21
+.end method
+
+.method static synthetic access$0(Landroid/content/Context;I)Z
+    .registers 3
+    .parameter
+    .parameter
+
+    .prologue
+    .line 362
+    invoke-static {p0, p1}, Lcom/android/server/status/ModUtils;->doKey(Landroid/content/Context;I)Z
+
+    move-result v0
+
+    return v0
+.end method
+
+.method public static alwaysShowStatusIcons(Landroid/content/Context;)Z
+    .registers 5
+    .parameter "context"
+
+    .prologue
+    const/4 v2, 0x0
+
+    .line 103
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v1
+
+    .line 105
+    .local v1, resolver:Landroid/content/ContentResolver;
+    :try_start_5
+    const-string v3, "mod.option.always_show_status_icons"
+
+    invoke-static {v1, v3}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;)I
+    :try_end_a
+    .catch Landroid/provider/Settings$SettingNotFoundException; {:try_start_5 .. :try_end_a} :catch_f
+
+    move-result v3
+
+    if-lez v3, :cond_e
+
+    const/4 v2, 0x1
+
+    .line 107
+    :cond_e
+    :goto_e
+    return v2
+
+    .line 106
+    :catch_f
+    move-exception v0
+
+    .line 107
+    .local v0, e:Landroid/provider/Settings$SettingNotFoundException;
+    goto :goto_e
+.end method
+
+.method public static disableDragToUnlock(Landroid/content/Context;)Z
+    .registers 5
+    .parameter "context"
+
+    .prologue
+    const/4 v2, 0x0
+
+    .line 112
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v1
+
+    .line 114
+    .local v1, resolver:Landroid/content/ContentResolver;
+    :try_start_5
+    const-string v3, "mod.option.disable_drag_to_unlock"
+
+    invoke-static {v1, v3}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;)I
+    :try_end_a
+    .catch Landroid/provider/Settings$SettingNotFoundException; {:try_start_5 .. :try_end_a} :catch_f
+
+    move-result v3
+
+    if-lez v3, :cond_e
+
+    const/4 v2, 0x1
+
+    .line 116
+    :cond_e
+    :goto_e
+    return v2
+
+    .line 115
+    :catch_f
+    move-exception v0
+
+    .line 116
+    .local v0, e:Landroid/provider/Settings$SettingNotFoundException;
+    goto :goto_e
+.end method
+
+.method public static doAction(Landroid/content/Context;Ljava/lang/String;)Z
+    .registers 6
+    .parameter "context"
+    .parameter "action"
+
+    .prologue
+    const/4 v0, 0x0
+
+    .line 278
+    if-eqz p1, :cond_9
+
+    invoke-virtual {p1}, Ljava/lang/String;->length()I
+
+    move-result v1
+
+    if-nez v1, :cond_a
+
+    .line 306
+    :cond_9
+    :goto_9
+    return v0
+
+    .line 281
+    :cond_a
+    const-string v1, "PACKAGE:"
+
+    invoke-virtual {p1, v1}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_21
+
+    .line 282
+    const-string v0, "PACKAGE:"
+
+    invoke-virtual {v0}, Ljava/lang/String;->length()I
+
+    move-result v0
+
+    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {p0, v0}, Lcom/android/server/status/ModUtils;->doPackage(Landroid/content/Context;Ljava/lang/String;)Z
+
+    move-result v0
+
+    goto :goto_9
+
+    .line 284
+    :cond_21
+    const-string v1, "ACTIVITY:"
+
+    invoke-virtual {p1, v1}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_38
+
+    .line 285
+    const-string v0, "ACTIVITY:"
+
+    invoke-virtual {v0}, Ljava/lang/String;->length()I
+
+    move-result v0
+
+    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {p0, v0}, Lcom/android/server/status/ModUtils;->doActivity(Landroid/content/Context;Ljava/lang/String;)Z
+
+    move-result v0
+
+    goto :goto_9
+
+    .line 287
+    :cond_38
+    const-string v1, "BROADCAST:"
+
+    invoke-virtual {p1, v1}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_4f
+
+    .line 288
+    const-string v0, "BROADCAST:"
+
+    invoke-virtual {v0}, Ljava/lang/String;->length()I
+
+    move-result v0
+
+    invoke-virtual {p1, v0}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {p0, v0}, Lcom/android/server/status/ModUtils;->doBroadcast(Landroid/content/Context;Ljava/lang/String;)Z
+
+    move-result v0
+
+    goto :goto_9
+
+    .line 290
+    :cond_4f
+    const-string v1, "KEY:"
+
+    invoke-virtual {p1, v1}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_66
+
+    .line 291
+    new-instance v0, Ljava/lang/Thread;
+
+    new-instance v1, Lcom/android/server/status/ModUtils$1;
+
+    invoke-direct {v1, p0, p1}, Lcom/android/server/status/ModUtils$1;-><init>(Landroid/content/Context;Ljava/lang/String;)V
+
+    invoke-direct {v0, v1}, Ljava/lang/Thread;-><init>(Ljava/lang/Runnable;)V
+
+    .line 295
+    invoke-virtual {v0}, Ljava/lang/Thread;->start()V
+
+    .line 296
+    const/4 v0, 0x1
+
+    goto :goto_9
+
+    .line 299
+    :cond_66
+    const-string v1, "QUICKNAV"
+
+    invoke-virtual {p1, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_73
+
+    .line 300
+    invoke-static {p0}, Lcom/android/server/status/ModUtils;->doToggleQuicknav(Landroid/content/Context;)Z
+
+    move-result v0
+
+    goto :goto_9
+
+    .line 302
+    :cond_73
+    const-string v1, "GLOWLIGHT"
+
+    invoke-virtual {p1, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_80
+
+    .line 303
+    invoke-static {p0}, Lcom/android/server/status/ModUtils;->doToggleGlowlight(Landroid/content/Context;)Z
+
+    move-result v0
+
+    goto :goto_9
+
+    .line 305
+    :cond_80
+    const-string v1, "NookMod"
+
+    new-instance v2, Ljava/lang/StringBuilder;
+
+    const-string v3, "doAction() unknown action: "
+
+    invoke-direct {v2, v3}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v2
+
+    invoke-static {v1, v2}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    goto/16 :goto_9
+.end method
+
+.method private static doActivity(Landroid/content/Context;Ljava/lang/String;)Z
+    .registers 3
+    .parameter "context"
+    .parameter "command"
+
+    .prologue
+    .line 347
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p1}, Ljava/lang/String;->length()I
+
+    move-result v0
+
+    if-nez v0, :cond_a
+
+    .line 348
+    :cond_8
+    const/4 v0, 0x0
+
+    .line 351
+    :goto_9
+    return v0
+
+    .line 350
+    :cond_a
+    invoke-static {p1}, Lcom/android/server/status/ModUtils;->getIntentFromString(Ljava/lang/String;)Landroid/content/Intent;
+
+    move-result-object v0
+
+    invoke-virtual {p0, v0}, Landroid/content/Context;->startActivity(Landroid/content/Intent;)V
+
+    .line 351
+    const/4 v0, 0x1
+
+    goto :goto_9
+.end method
+
+.method private static doBroadcast(Landroid/content/Context;Ljava/lang/String;)Z
+    .registers 3
+    .parameter "context"
+    .parameter "command"
+
+    .prologue
+    .line 355
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p1}, Ljava/lang/String;->length()I
+
+    move-result v0
+
+    if-nez v0, :cond_a
+
+    .line 356
+    :cond_8
+    const/4 v0, 0x0
+
+    .line 359
+    :goto_9
+    return v0
+
+    .line 358
+    :cond_a
+    invoke-static {p1}, Lcom/android/server/status/ModUtils;->getIntentFromString(Ljava/lang/String;)Landroid/content/Intent;
+
+    move-result-object v0
+
+    invoke-virtual {p0, v0}, Landroid/content/Context;->sendBroadcast(Landroid/content/Intent;)V
+
+    .line 359
+    const/4 v0, 0x1
+
+    goto :goto_9
+.end method
+
+.method private static doKey(Landroid/content/Context;I)Z
+    .registers 13
+    .parameter "context"
+    .parameter "keycode"
+
+    .prologue
+    const/4 v5, 0x1
+
+    const/4 v4, 0x0
+
+    .line 363
+    if-gtz p1, :cond_5
+
+    .line 385
+    :goto_4
+    return v4
+
+    .line 372
+    :cond_5
+    :try_start_5
+    const-string v6, "android.os.ServiceManager"
+
+    invoke-static {v6}, Ljava/lang/Class;->forName(Ljava/lang/String;)Ljava/lang/Class;
+
+    move-result-object v6
+
+    const-string v7, "getService"
+
+    const/4 v8, 0x1
+
+    new-array v8, v8, [Ljava/lang/Class;
+
+    const/4 v9, 0x0
+
+    const-class v10, Ljava/lang/String;
+
+    aput-object v10, v8, v9
+
+    invoke-virtual {v6, v7, v8}, Ljava/lang/Class;->getMethod(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;
+
+    move-result-object v6
+
+    const/4 v7, 0x0
+
+    const/4 v8, 0x1
+
+    new-array v8, v8, [Ljava/lang/Object;
+
+    const/4 v9, 0x0
+
+    const-string v10, "window"
+
+    aput-object v10, v8, v9
+
+    invoke-virtual {v6, v7, v8}, Ljava/lang/reflect/Method;->invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
+
+    move-result-object v3
+
+    check-cast v3, Landroid/os/IBinder;
+
+    .line 374
+    .local v3, wmbinder:Landroid/os/IBinder;
+    const-string v6, "android.view.IWindowManager$Stub"
+
+    invoke-static {v6}, Ljava/lang/Class;->forName(Ljava/lang/String;)Ljava/lang/Class;
+
+    move-result-object v6
+
+    const-string v7, "asInterface"
+
+    const/4 v8, 0x1
+
+    new-array v8, v8, [Ljava/lang/Class;
+
+    const/4 v9, 0x0
+
+    const-class v10, Landroid/os/IBinder;
+
+    aput-object v10, v8, v9
+
+    invoke-virtual {v6, v7, v8}, Ljava/lang/Class;->getMethod(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;
+
+    move-result-object v6
+
+    const/4 v7, 0x0
+
+    const/4 v8, 0x1
+
+    new-array v8, v8, [Ljava/lang/Object;
+
+    const/4 v9, 0x0
+
+    aput-object v3, v8, v9
+
+    invoke-virtual {v6, v7, v8}, Ljava/lang/reflect/Method;->invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
+
+    move-result-object v2
+
+    .line 375
+    .local v2, windowman:Ljava/lang/Object;
+    const-string v6, "android.view.IWindowManager"
+
+    invoke-static {v6}, Ljava/lang/Class;->forName(Ljava/lang/String;)Ljava/lang/Class;
+
+    move-result-object v6
+
+    const-string v7, "injectKeyEvent"
+
+    const/4 v8, 0x2
+
+    new-array v8, v8, [Ljava/lang/Class;
+
+    const/4 v9, 0x0
+
+    const-class v10, Landroid/view/KeyEvent;
+
+    aput-object v10, v8, v9
+
+    const/4 v9, 0x1
+
+    sget-object v10, Ljava/lang/Boolean;->TYPE:Ljava/lang/Class;
+
+    aput-object v10, v8, v9
+
+    invoke-virtual {v6, v7, v8}, Ljava/lang/Class;->getMethod(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;
+
+    move-result-object v1
+
+    .line 377
+    .local v1, injectKeyEvent:Ljava/lang/reflect/Method;
+    const/4 v6, 0x2
+
+    new-array v6, v6, [Ljava/lang/Object;
+
+    const/4 v7, 0x0
+
+    new-instance v8, Landroid/view/KeyEvent;
+
+    const/4 v9, 0x0
+
+    invoke-direct {v8, v9, p1}, Landroid/view/KeyEvent;-><init>(II)V
+
+    aput-object v8, v6, v7
+
+    const/4 v7, 0x1
+
+    const/4 v8, 0x0
+
+    invoke-static {v8}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;
+
+    move-result-object v8
+
+    aput-object v8, v6, v7
+
+    invoke-virtual {v1, v2, v6}, Ljava/lang/reflect/Method;->invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
+
+    .line 378
+    const/4 v6, 0x2
+
+    new-array v6, v6, [Ljava/lang/Object;
+
+    const/4 v7, 0x0
+
+    new-instance v8, Landroid/view/KeyEvent;
+
+    const/4 v9, 0x1
+
+    invoke-direct {v8, v9, p1}, Landroid/view/KeyEvent;-><init>(II)V
+
+    aput-object v8, v6, v7
+
+    const/4 v7, 0x1
+
+    const/4 v8, 0x0
+
+    invoke-static {v8}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;
+
+    move-result-object v8
+
+    aput-object v8, v6, v7
+
+    invoke-virtual {v1, v2, v6}, Ljava/lang/reflect/Method;->invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
+    :try_end_8e
+    .catch Ljava/lang/Exception; {:try_start_5 .. :try_end_8e} :catch_91
+
+    move v4, v5
+
+    .line 385
+    goto/16 :goto_4
+
+    .line 379
+    .end local v1           #injectKeyEvent:Ljava/lang/reflect/Method;
+    .end local v2           #windowman:Ljava/lang/Object;
+    .end local v3           #wmbinder:Landroid/os/IBinder;
+    :catch_91
+    move-exception v0
+
+    .line 380
+    .local v0, e:Ljava/lang/Exception;
+    const-string v5, "NookMod"
+
+    const-string v6, "doKey failed"
+
+    invoke-static {v5, v6}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    goto/16 :goto_4
+.end method
+
+.method private static doPackage(Landroid/content/Context;Ljava/lang/String;)Z
+    .registers 7
+    .parameter "context"
+    .parameter "command"
+
+    .prologue
+    const/4 v1, 0x0
+
+    .line 332
+    if-eqz p1, :cond_9
+
+    invoke-virtual {p1}, Ljava/lang/String;->length()I
+
+    move-result v2
+
+    if-nez v2, :cond_a
+
+    .line 343
+    :cond_9
+    :goto_9
+    return v1
+
+    .line 337
+    :cond_a
+    invoke-virtual {p0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;
+
+    move-result-object v2
+
+    invoke-virtual {v2, p1}, Landroid/content/pm/PackageManager;->getLaunchIntentForPackage(Ljava/lang/String;)Landroid/content/Intent;
+
+    move-result-object v0
+
+    .line 338
+    .local v0, intent:Landroid/content/Intent;
+    if-nez v0, :cond_29
+
+    .line 339
+    const-string v2, "NookMod"
+
+    new-instance v3, Ljava/lang/StringBuilder;
+
+    const-string v4, "doPackage() cannot find intent for "
+
+    invoke-direct {v3, v4}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v3, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v3
+
+    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v3
+
+    invoke-static {v2, v3}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    goto :goto_9
+
+    .line 342
+    :cond_29
+    invoke-virtual {p0, v0}, Landroid/content/Context;->startActivity(Landroid/content/Intent;)V
+
+    .line 343
+    const/4 v1, 0x1
+
+    goto :goto_9
+.end method
+
+.method private static doToggleGlowlight(Landroid/content/Context;)Z
+    .registers 9
+    .parameter "context"
+
+    .prologue
+    const/4 v3, 0x1
+
+    const/4 v4, 0x0
+
+    .line 402
+    invoke-static {}, Lcom/android/internal/policy/impl/ModUtils;->getContext()Lcom/android/internal/policy/impl/PhoneWindowManager;
+
+    move-result-object v2
+
+    .line 404
+    .local v2, wms:Lcom/android/internal/policy/impl/PhoneWindowManager;
+    :try_start_6
+    const-string v5, "com.android.internal.policy.impl.PhoneWindowManager"
+
+    invoke-static {v5}, Ljava/lang/Class;->forName(Ljava/lang/String;)Ljava/lang/Class;
+
+    move-result-object v5
+
+    const-string v6, "toggleLights"
+
+    const/4 v7, 0x0
+
+    new-array v7, v7, [Ljava/lang/Class;
+
+    invoke-virtual {v5, v6, v7}, Ljava/lang/Class;->getDeclaredMethod(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;
+
+    move-result-object v1
+
+    .line 405
+    .local v1, toggleLights:Ljava/lang/reflect/Method;
+    const/4 v5, 0x1
+
+    invoke-virtual {v1, v5}, Ljava/lang/reflect/Method;->setAccessible(Z)V
+
+    .line 406
+    const/4 v5, 0x0
+
+    new-array v5, v5, [Ljava/lang/Object;
+
+    invoke-virtual {v1, v2, v5}, Ljava/lang/reflect/Method;->invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
+    :try_end_1f
+    .catch Ljava/lang/Exception; {:try_start_6 .. :try_end_1f} :catch_20
+
+    .line 411
+    .end local v1           #toggleLights:Ljava/lang/reflect/Method;
+    :goto_1f
+    return v3
+
+    .line 407
+    :catch_20
+    move-exception v0
+
+    .line 408
+    .local v0, e:Ljava/lang/Exception;
+    const-string v3, "NookMod"
+
+    new-instance v5, Ljava/lang/StringBuilder;
+
+    const-string v6, "toggle light failed "
+
+    invoke-direct {v5, v6}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v0}, Ljava/lang/Exception;->toString()Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
+
+    const-string v6, "\n"
+
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
+
+    invoke-virtual {v0}, Ljava/lang/Exception;->getCause()Ljava/lang/Throwable;
+
+    move-result-object v6
+
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
+
+    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v5
+
+    invoke-static {v3, v5}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    move v3, v4
+
+    .line 409
+    goto :goto_1f
+.end method
+
+.method private static doToggleQuicknav(Landroid/content/Context;)Z
+    .registers 7
+    .parameter "context"
+
+    .prologue
+    const/4 v2, 0x0
+
+    .line 389
+    const-string v3, "statusbar"
+
+    invoke-virtual {p0, v3}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v1
+
+    .line 392
+    .local v1, statusbar:Ljava/lang/Object;
+    :try_start_7
+    const-string v3, "android.app.StatusBarManager"
+
+    invoke-static {v3}, Ljava/lang/Class;->forName(Ljava/lang/String;)Ljava/lang/Class;
+
+    move-result-object v3
+
+    const-string v4, "toggleQuickNav"
+
+    const/4 v5, 0x0
+
+    new-array v5, v5, [Ljava/lang/Class;
+
+    invoke-virtual {v3, v4, v5}, Ljava/lang/Class;->getMethod(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;
+
+    move-result-object v3
+
+    const/4 v4, 0x0
+
+    new-array v4, v4, [Ljava/lang/Object;
+
+    invoke-virtual {v3, v1, v4}, Ljava/lang/reflect/Method;->invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
+    :try_end_1c
+    .catch Ljava/lang/Exception; {:try_start_7 .. :try_end_1c} :catch_1e
+
+    .line 397
+    const/4 v2, 0x1
+
+    :goto_1d
+    return v2
+
+    .line 393
+    :catch_1e
+    move-exception v0
+
+    .line 395
+    .local v0, e:Ljava/lang/Exception;
+    goto :goto_1d
+.end method
+
+.method private static getButtonBitmap(Landroid/content/Context;Ljava/lang/String;)Landroid/graphics/Bitmap;
+    .registers 11
+    .parameter "context"
+    .parameter "buttonName"
+
+    .prologue
+    const/4 v6, 0x0
+
+    .line 236
+    if-eqz p1, :cond_9
+
+    invoke-virtual {p1}, Ljava/lang/String;->length()I
+
+    move-result v7
+
+    if-nez v7, :cond_a
+
+    .line 261
+    :cond_9
+    :goto_9
+    return-object v6
+
+    .line 239
+    :cond_a
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v5
+
+    .line 240
+    .local v5, resolver:Landroid/content/ContentResolver;
+    new-instance v7, Ljava/lang/StringBuilder;
+
+    const-string v8, "mod."
+
+    invoke-direct {v7, v8}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v7, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v7
+
+    const-string v8, ".icon"
+
+    invoke-virtual {v7, v8}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v7
+
+    invoke-virtual {v7}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v7
+
+    invoke-static {v5, v7}, Landroid/provider/Settings$System;->getString(Landroid/content/ContentResolver;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+    .line 244
+    .local v0, bitmapId:Ljava/lang/String;
+    if-eqz v0, :cond_9
+
+    invoke-virtual {v0}, Ljava/lang/String;->length()I
+
+    move-result v7
+
+    if-eqz v7, :cond_9
+
+    .line 247
+    const-string v7, "^\\d+$"
+
+    invoke-virtual {v0, v7}, Ljava/lang/String;->matches(Ljava/lang/String;)Z
+
+    move-result v7
+
+    if-eqz v7, :cond_44
+
+    .line 249
+    invoke-virtual {p0}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+
+    move-result-object v4
+
+    .line 250
+    .local v4, res:Landroid/content/res/Resources;
+    invoke-static {v0}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v6
+
+    invoke-static {v4, v6}, Landroid/graphics/BitmapFactory;->decodeResource(Landroid/content/res/Resources;I)Landroid/graphics/Bitmap;
+
+    move-result-object v6
+
+    goto :goto_9
+
+    .line 253
+    .end local v4           #res:Landroid/content/res/Resources;
+    :cond_44
+    invoke-virtual {p0}, Landroid/content/Context;->getPackageManager()Landroid/content/pm/PackageManager;
+
+    move-result-object v3
+
+    .line 256
+    .local v3, pm:Landroid/content/pm/PackageManager;
+    :try_start_48
+    invoke-virtual {v3, v0}, Landroid/content/pm/PackageManager;->getApplicationIcon(Ljava/lang/String;)Landroid/graphics/drawable/Drawable;
+    :try_end_4b
+    .catch Landroid/content/pm/PackageManager$NameNotFoundException; {:try_start_48 .. :try_end_4b} :catch_53
+
+    move-result-object v2
+
+    .line 261
+    .local v2, icon:Landroid/graphics/drawable/Drawable;
+    check-cast v2, Landroid/graphics/drawable/BitmapDrawable;
+
+    .end local v2           #icon:Landroid/graphics/drawable/Drawable;
+    invoke-virtual {v2}, Landroid/graphics/drawable/BitmapDrawable;->getBitmap()Landroid/graphics/Bitmap;
+
+    move-result-object v6
+
+    goto :goto_9
+
+    .line 257
+    :catch_53
+    move-exception v1
+
+    .line 258
+    .local v1, e:Landroid/content/pm/PackageManager$NameNotFoundException;
+    goto :goto_9
+.end method
+
+.method private static getButtonLabel(Landroid/content/Context;Ljava/lang/String;)Ljava/lang/String;
+    .registers 5
+    .parameter "context"
+    .parameter "buttonName"
+
+    .prologue
+    .line 266
+    if-eqz p1, :cond_8
+
+    invoke-virtual {p1}, Ljava/lang/String;->length()I
+
+    move-result v1
+
+    if-nez v1, :cond_a
+
+    .line 267
+    :cond_8
+    const/4 v1, 0x0
+
+    .line 270
+    :goto_9
+    return-object v1
+
+    .line 269
+    :cond_a
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    .line 270
+    .local v0, resolver:Landroid/content/ContentResolver;
+    new-instance v1, Ljava/lang/StringBuilder;
+
+    const-string v2, "mod."
+
+    invoke-direct {v1, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {v1, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    const-string v2, ".label"
+
+    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-static {v0, v1}, Landroid/provider/Settings$System;->getString(Landroid/content/ContentResolver;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v1
+
+    goto :goto_9
+.end method
+
+.method private static getButtonName(I)Ljava/lang/String;
+    .registers 2
+    .parameter "id"
+
+    .prologue
+    .line 67
+    sparse-switch p0, :sswitch_data_26
+
+    .line 81
+    const/4 v0, 0x0
+
+    :goto_4
+    return-object v0
+
+    .line 69
+    :sswitch_5
+    const-string v0, "quicknav.1"
+
+    goto :goto_4
+
+    .line 70
+    :sswitch_8
+    const-string v0, "quicknav.2"
+
+    goto :goto_4
+
+    .line 71
+    :sswitch_b
+    const-string v0, "quicknav.3"
+
+    goto :goto_4
+
+    .line 72
+    :sswitch_e
+    const-string v0, "quicknav.4"
+
+    goto :goto_4
+
+    .line 73
+    :sswitch_11
+    const-string v0, "quicknav.5"
+
+    goto :goto_4
+
+    .line 74
+    :sswitch_14
+    const-string v0, "quicknav.6"
+
+    goto :goto_4
+
+    .line 75
+    :sswitch_17
+    const-string v0, "statusbar.back"
+
+    goto :goto_4
+
+    .line 76
+    :sswitch_1a
+    const-string v0, "statusbar.menu"
+
+    goto :goto_4
+
+    .line 77
+    :sswitch_1d
+    const-string v0, "statusbar.readnow"
+
+    goto :goto_4
+
+    .line 78
+    :sswitch_20
+    const-string v0, "statusbar.notify"
+
+    goto :goto_4
+
+    .line 79
+    :sswitch_23
+    const-string v0, "statusbar.glowlight"
+
+    goto :goto_4
+
+    .line 67
+    :sswitch_data_26
+    .sparse-switch
+        0x1020196 -> :sswitch_5
+        0x1020197 -> :sswitch_8
+        0x1020198 -> :sswitch_b
+        0x1020199 -> :sswitch_e
+        0x102019a -> :sswitch_11
+        0x102019b -> :sswitch_14
+        0x1020220 -> :sswitch_17
+        0x1020221 -> :sswitch_1a
+        0x1020222 -> :sswitch_1d
+        0x1020223 -> :sswitch_20
+        0x1020225 -> :sswitch_23
+    .end sparse-switch
+.end method
+
+.method private static getIntentFromString(Ljava/lang/String;)Landroid/content/Intent;
+    .registers 10
+    .parameter "intentStr"
+
+    .prologue
+    const/16 v8, 0x9
+
+    const/4 v7, 0x6
+
+    const/4 v6, 0x0
+
+    .line 310
+    const-string v3, ";"
+
+    invoke-virtual {p0, v3}, Ljava/lang/String;->split(Ljava/lang/String;)[Ljava/lang/String;
+
+    move-result-object v0
+
+    .line 311
+    .local v0, chunk:[Ljava/lang/String;
+    new-instance v2, Landroid/content/Intent;
+
+    aget-object v3, v0, v6
+
+    invoke-direct {v2, v3}, Landroid/content/Intent;-><init>(Ljava/lang/String;)V
+
+    .line 312
+    .local v2, intent:Landroid/content/Intent;
+    const-string v3, "NookMod"
+
+    new-instance v4, Ljava/lang/StringBuilder;
+
+    const-string v5, "new intent: "
+
+    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    aget-object v5, v0, v6
+
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v4
+
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v4
+
+    invoke-static {v3, v4}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    .line 314
+    const/4 v1, 0x1
+
+    .local v1, i:I
+    :goto_28
+    array-length v3, v0
+
+    if-lt v1, v3, :cond_2c
+
+    .line 328
+    return-object v2
+
+    .line 316
+    :cond_2c
+    aget-object v3, v0, v1
+
+    const-string v4, "CATEGORY:"
+
+    invoke-virtual {v3, v4}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z
+
+    move-result v3
+
+    if-eqz v3, :cond_59
+
+    .line 318
+    const-string v3, "NookMod"
+
+    new-instance v4, Ljava/lang/StringBuilder;
+
+    const-string v5, "intent - adding category: "
+
+    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    aget-object v5, v0, v1
+
+    invoke-virtual {v5, v8}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v5
+
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v4
+
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v4
+
+    invoke-static {v3, v4}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    .line 319
+    aget-object v3, v0, v1
+
+    invoke-virtual {v3, v8}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v3
+
+    invoke-virtual {v2, v3}, Landroid/content/Intent;->addCategory(Ljava/lang/String;)Landroid/content/Intent;
+
+    .line 322
+    :cond_59
+    aget-object v3, v0, v1
+
+    const-string v4, "FLAGS:"
+
+    invoke-virtual {v3, v4}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z
+
+    move-result v3
+
+    if-eqz v3, :cond_8a
+
+    .line 324
+    const-string v3, "NookMod"
+
+    new-instance v4, Ljava/lang/StringBuilder;
+
+    const-string v5, "intent - adding flags: "
+
+    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    aget-object v5, v0, v1
+
+    invoke-virtual {v5, v7}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v5
+
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v4
+
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v4
+
+    invoke-static {v3, v4}, Landroid/util/Log;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    .line 325
+    aget-object v3, v0, v1
+
+    invoke-virtual {v3, v7}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v3
+
+    invoke-static {v3}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v3
+
+    invoke-virtual {v2, v3}, Landroid/content/Intent;->setFlags(I)Landroid/content/Intent;
+
+    .line 314
+    :cond_8a
+    add-int/lit8 v1, v1, 0x1
+
+    goto :goto_28
+.end method
+
+.method public static getVersion()Ljava/lang/String;
+    .registers 1
+
+    .prologue
+    .line 64
+    const-string v0, "0.2.1"
+
+    return-object v0
+.end method
+
+.method public static onScreenResume(Landroid/content/Context;)V
+    .registers 3
+    .parameter "context"
+
+    .prologue
+    .line 134
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    .line 136
+    .local v0, resolver:Landroid/content/ContentResolver;
+    :try_start_4
+    const-string v1, "mod.option.restore_glowlight_on_wake"
+
+    invoke-static {v0, v1}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;)I
+
+    move-result v1
+
+    if-lez v1, :cond_17
+
+    .line 137
+    const-string v1, "mod.misc.wake_screen_brightness_mode"
+
+    invoke-static {v0, v1}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;)I
+
+    move-result v1
+
+    if-lez v1, :cond_17
+
+    .line 138
+    invoke-static {p0}, Lcom/android/server/status/ModUtils;->doToggleGlowlight(Landroid/content/Context;)Z
+    :try_end_17
+    .catch Landroid/provider/Settings$SettingNotFoundException; {:try_start_4 .. :try_end_17} :catch_18
+
+    .line 141
+    :cond_17
+    :goto_17
+    return-void
+
+    .line 139
+    :catch_18
+    move-exception v1
+
+    goto :goto_17
+.end method
+
+.method public static onScreenSleep(Landroid/content/Context;)V
+    .registers 4
+    .parameter "context"
+
+    .prologue
+    .line 121
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v1
+
+    .line 123
+    .local v1, resolver:Landroid/content/ContentResolver;
+    :try_start_4
+    const-string v2, "mod.option.restore_glowlight_on_wake"
+
+    invoke-static {v1, v2}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;)I
+
+    move-result v2
+
+    if-lez v2, :cond_17
+
+    .line 124
+    const-string v2, "screen_brightness_mode"
+
+    invoke-static {v1, v2}, Landroid/provider/Settings$System;->getString(Landroid/content/ContentResolver;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+    .line 125
+    .local v0, lightStatus:Ljava/lang/String;
+    const-string v2, "mod.misc.wake_screen_brightness_mode"
+
+    invoke-static {v1, v2, v0}, Landroid/provider/Settings$System;->putString(Landroid/content/ContentResolver;Ljava/lang/String;Ljava/lang/String;)Z
+    :try_end_17
+    .catch Landroid/provider/Settings$SettingNotFoundException; {:try_start_4 .. :try_end_17} :catch_18
+
+    .line 130
+    .end local v0           #lightStatus:Ljava/lang/String;
+    :cond_17
+    :goto_17
+    return-void
+
+    .line 128
+    :catch_18
+    move-exception v2
+
+    goto :goto_17
+.end method
+
+.method public static overrideShopButton(Landroid/content/Context;)Ljava/lang/Boolean;
+    .registers 2
+    .parameter "context"
+
+    .prologue
+    .line 145
+    const-string v0, "QUICKNAV_SHOP"
+
+    invoke-static {p0, v0}, Lcom/android/server/status/ModUtils;->getButtonBitmap(Landroid/content/Context;Ljava/lang/String;)Landroid/graphics/Bitmap;
+
+    move-result-object v0
+
+    if-eqz v0, :cond_e
+
+    const/4 v0, 0x1
+
+    invoke-static {v0}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;
+
+    move-result-object v0
+
+    :goto_d
+    return-object v0
+
+    :cond_e
+    const/4 v0, 0x0
+
+    invoke-static {v0}, Ljava/lang/Boolean;->valueOf(Z)Ljava/lang/Boolean;
+
+    move-result-object v0
+
+    goto :goto_d
+.end method
+
+.method public static replaceQuicknavIcon(Landroid/content/Context;Landroid/widget/ImageView;)V
+    .registers 42
+    .parameter "context"
+    .parameter "view"
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/content/pm/PackageManager$NameNotFoundException;
+        }
+    .end annotation
+
+    .prologue
+    .line 150
+    if-eqz p1, :cond_8
+
+    invoke-virtual/range {p1 .. p1}, Landroid/widget/ImageView;->getId()I
+
+    move-result v3
+
+    if-nez v3, :cond_9
+
+    .line 232
+    :cond_8
+    :goto_8
+    return-void
+
+    .line 153
+    :cond_9
+    invoke-virtual/range {p1 .. p1}, Landroid/widget/ImageView;->getId()I
+
+    move-result v3
+
+    invoke-static {v3}, Lcom/android/server/status/ModUtils;->getButtonName(I)Ljava/lang/String;
+
+    move-result-object v27
+
+    .line 154
+    .local v27, buttonName:Ljava/lang/String;
+    if-eqz v27, :cond_8
+
+    invoke-virtual/range {v27 .. v27}, Ljava/lang/String;->length()I
+
+    move-result v3
+
+    if-eqz v3, :cond_8
+
+    .line 159
+    move-object/from16 v0, p0
+
+    move-object/from16 v1, v27
+
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->getButtonBitmap(Landroid/content/Context;Ljava/lang/String;)Landroid/graphics/Bitmap;
+
+    move-result-object v29
+
+    .line 160
+    .local v29, icon:Landroid/graphics/Bitmap;
+    move-object/from16 v0, p0
+
+    move-object/from16 v1, v27
+
+    invoke-static {v0, v1}, Lcom/android/server/status/ModUtils;->getButtonLabel(Landroid/content/Context;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v9
+
+    .line 162
+    .local v9, iconLabel:Ljava/lang/String;
+    if-eqz v9, :cond_31
+
+    invoke-virtual {v9}, Ljava/lang/String;->length()I
+
+    move-result v3
+
+    if-nez v3, :cond_33
+
+    :cond_31
+    if-eqz v29, :cond_8
+
+    .line 165
+    :cond_33
+    const-string v3, "window"
+
+    move-object/from16 v0, p0
+
+    invoke-virtual {v0, v3}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v39
+
+    check-cast v39, Landroid/view/WindowManager;
+
+    .line 166
+    .local v39, wm:Landroid/view/WindowManager;
+    invoke-interface/range {v39 .. v39}, Landroid/view/WindowManager;->getDefaultDisplay()Landroid/view/Display;
+
+    move-result-object v28
+
+    .line 168
+    .local v28, display:Landroid/view/Display;
+    invoke-virtual/range {p0 .. p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v35
+
+    .line 169
+    .local v35, resolver:Landroid/content/ContentResolver;
+    const-string v3, "has_glowlight"
+
+    move-object/from16 v0, v35
+
+    invoke-static {v0, v3}, Landroid/provider/Settings$System;->getString(Landroid/content/ContentResolver;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v3
+
+    invoke-static {v3}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+
+    move-result v3
+
+    if-lez v3, :cond_149
+
+    const/16 v24, 0x1
+
+    .line 170
+    .local v24, bHasGlowlight:Z
+    :goto_55
+    if-eqz v24, :cond_14d
+
+    const/16 v25, 0x6
+
+    .line 171
+    .local v25, buttonCount:I
+    :goto_59
+    invoke-virtual/range {v28 .. v28}, Landroid/view/Display;->getWidth()I
+
+    move-result v3
+
+    div-int v11, v3, v25
+
+    .line 172
+    .local v11, buttonWidth:I
+    const/16 v26, 0x70
+
+    .line 174
+    .local v26, buttonHeight:I
+    const/16 v31, 0x44
+
+    .line 175
+    .local v31, labelOffsetY:I
+    const/16 v30, 0x60
+
+    .line 177
+    .local v30, iconOffsetY:I
+    new-instance v2, Landroid/graphics/Canvas;
+
+    invoke-direct {v2}, Landroid/graphics/Canvas;-><init>()V
+
+    .line 178
+    .local v2, canvas:Landroid/graphics/Canvas;
+    new-instance v7, Landroid/graphics/Paint;
+
+    invoke-direct {v7}, Landroid/graphics/Paint;-><init>()V
+
+    .line 179
+    .local v7, paint:Landroid/graphics/Paint;
+    const/high16 v3, -0x100
+
+    invoke-virtual {v7, v3}, Landroid/graphics/Paint;->setColor(I)V
+
+    .line 181
+    sget-object v3, Landroid/graphics/Bitmap$Config;->RGB_565:Landroid/graphics/Bitmap$Config;
+
+    move/from16 v0, v26
+
+    invoke-static {v11, v0, v3}, Landroid/graphics/Bitmap;->createBitmap(IILandroid/graphics/Bitmap$Config;)Landroid/graphics/Bitmap;
+
+    move-result-object v32
+
+    .line 182
+    .local v32, newBitmap:Landroid/graphics/Bitmap;
+    move-object/from16 v0, v32
+
+    invoke-virtual {v2, v0}, Landroid/graphics/Canvas;->setBitmap(Landroid/graphics/Bitmap;)V
+
+    .line 184
+    const/4 v3, -0x1
+
+    invoke-virtual {v2, v3}, Landroid/graphics/Canvas;->drawColor(I)V
+
+    .line 186
+    const/high16 v3, 0x4140
+
+    invoke-virtual {v7, v3}, Landroid/graphics/Paint;->setStrokeWidth(F)V
+
+    .line 187
+    const/4 v3, 0x0
+
+    const/4 v4, 0x0
+
+    add-int/lit8 v5, v11, -0x1
+
+    int-to-float v5, v5
+
+    const/4 v6, 0x0
+
+    invoke-virtual/range {v2 .. v7}, Landroid/graphics/Canvas;->drawLine(FFFFLandroid/graphics/Paint;)V
+
+    .line 189
+    const/high16 v3, 0x3f80
+
+    invoke-virtual {v7, v3}, Landroid/graphics/Paint;->setStrokeWidth(F)V
+
+    .line 190
+    invoke-virtual/range {p1 .. p1}, Landroid/widget/ImageView;->getId()I
+
+    move-result v3
+
+    const v4, 0x102019a
+
+    if-eq v3, v4, :cond_ae
+
+    .line 191
+    add-int/lit8 v3, v11, -0x1
+
+    int-to-float v3, v3
+
+    const/4 v4, 0x0
+
+    add-int/lit8 v5, v11, -0x1
+
+    int-to-float v5, v5
+
+    move/from16 v0, v26
+
+    int-to-float v6, v0
+
+    invoke-virtual/range {v2 .. v7}, Landroid/graphics/Canvas;->drawLine(FFFFLandroid/graphics/Paint;)V
+
+    .line 193
+    :cond_ae
+    if-eqz v29, :cond_d3
+
+    .line 194
+    invoke-virtual/range {v32 .. v32}, Landroid/graphics/Bitmap;->getWidth()I
+
+    move-result v3
+
+    invoke-virtual/range {v29 .. v29}, Landroid/graphics/Bitmap;->getWidth()I
+
+    move-result v4
+
+    sub-int/2addr v3, v4
+
+    div-int/lit8 v33, v3, 0x2
+
+    .line 195
+    .local v33, offsetX:I
+    invoke-virtual/range {v29 .. v29}, Landroid/graphics/Bitmap;->getHeight()I
+
+    move-result v3
+
+    sub-int v3, v30, v3
+
+    div-int/lit8 v34, v3, 0x2
+
+    .line 196
+    .local v34, offsetY:I
+    if-gez v34, :cond_c7
+
+    .line 197
+    const/16 v34, 0x0
+
+    .line 198
+    :cond_c7
+    move/from16 v0, v33
+
+    int-to-float v3, v0
+
+    move/from16 v0, v34
+
+    int-to-float v4, v0
+
+    const/4 v5, 0x0
+
+    move-object/from16 v0, v29
+
+    invoke-virtual {v2, v0, v3, v4, v5}, Landroid/graphics/Canvas;->drawBitmap(Landroid/graphics/Bitmap;FFLandroid/graphics/Paint;)V
+
+    .line 201
+    .end local v33           #offsetX:I
+    .end local v34           #offsetY:I
+    :cond_d3
+    if-eqz v9, :cond_140
+
+    invoke-virtual {v9}, Ljava/lang/String;->length()I
+
+    move-result v3
+
+    if-lez v3, :cond_140
+
+    .line 203
+    new-instance v10, Landroid/text/TextPaint;
+
+    invoke-direct {v10}, Landroid/text/TextPaint;-><init>()V
+
+    .line 204
+    .local v10, tpaint:Landroid/text/TextPaint;
+    sget-object v3, Landroid/graphics/Typeface;->DEFAULT:Landroid/graphics/Typeface;
+
+    invoke-virtual {v10, v3}, Landroid/text/TextPaint;->setTypeface(Landroid/graphics/Typeface;)Landroid/graphics/Typeface;
+
+    .line 205
+    const/high16 v3, 0x4190
+
+    invoke-virtual {v10, v3}, Landroid/text/TextPaint;->setTextSize(F)V
+
+    .line 206
+    const/4 v3, 0x1
+
+    invoke-virtual {v10, v3}, Landroid/text/TextPaint;->setFlags(I)V
+
+    .line 208
+    const/high16 v36, 0x3f80
+
+    .line 209
+    .local v36, scale:F
+    const v38, 0x3d4ccccd
+
+    .line 210
+    .local v38, scale_step:F
+    const/high16 v37, 0x3f00
+
+    .line 213
+    .local v37, scale_min:F
+    new-instance v8, Landroid/text/StaticLayout;
+
+    sget-object v12, Landroid/text/Layout$Alignment;->ALIGN_CENTER:Landroid/text/Layout$Alignment;
+
+    const v13, 0x3f4ccccd
+
+    const/4 v14, 0x0
+
+    const/4 v15, 0x1
+
+    invoke-direct/range {v8 .. v15}, Landroid/text/StaticLayout;-><init>(Ljava/lang/CharSequence;Landroid/text/TextPaint;ILandroid/text/Layout$Alignment;FFZ)V
+
+    .line 214
+    .local v8, layout:Landroid/text/StaticLayout;
+    :goto_101
+    invoke-virtual {v8}, Landroid/text/StaticLayout;->getLineCount()I
+
+    move-result v3
+
+    const/4 v4, 0x2
+
+    if-le v3, v4, :cond_10c
+
+    cmpl-float v3, v36, v37
+
+    if-gtz v3, :cond_151
+
+    .line 222
+    :cond_10c
+    invoke-virtual {v8}, Landroid/text/StaticLayout;->getLineCount()I
+
+    move-result v3
+
+    const/4 v4, 0x2
+
+    if-le v3, v4, :cond_130
+
+    .line 223
+    new-instance v8, Landroid/text/StaticLayout;
+
+    .end local v8           #layout:Landroid/text/StaticLayout;
+    const/4 v14, 0x0
+
+    invoke-virtual {v9}, Ljava/lang/String;->length()I
+
+    move-result v15
+
+    sget-object v18, Landroid/text/Layout$Alignment;->ALIGN_CENTER:Landroid/text/Layout$Alignment;
+
+    const v19, 0x3f4ccccd
+
+    const/high16 v20, 0x3f80
+
+    const/16 v21, 0x0
+
+    sget-object v22, Landroid/text/TextUtils$TruncateAt;->END:Landroid/text/TextUtils$TruncateAt;
+
+    move-object v12, v8
+
+    move-object v13, v9
+
+    move-object/from16 v16, v10
+
+    move/from16 v17, v11
+
+    move/from16 v23, v11
+
+    invoke-direct/range {v12 .. v23}, Landroid/text/StaticLayout;-><init>(Ljava/lang/CharSequence;IILandroid/text/TextPaint;ILandroid/text/Layout$Alignment;FFZLandroid/text/TextUtils$TruncateAt;I)V
+
+    .line 225
+    .restart local v8       #layout:Landroid/text/StaticLayout;
+    :cond_130
+    invoke-virtual {v2}, Landroid/graphics/Canvas;->save()I
+
+    .line 226
+    const/4 v3, 0x0
+
+    move/from16 v0, v31
+
+    int-to-float v4, v0
+
+    invoke-virtual {v2, v3, v4}, Landroid/graphics/Canvas;->translate(FF)V
+
+    .line 227
+    invoke-virtual {v8, v2}, Landroid/text/StaticLayout;->draw(Landroid/graphics/Canvas;)V
+
+    .line 228
+    invoke-virtual {v2}, Landroid/graphics/Canvas;->restore()V
+
+    .line 231
+    .end local v8           #layout:Landroid/text/StaticLayout;
+    .end local v10           #tpaint:Landroid/text/TextPaint;
+    .end local v36           #scale:F
+    .end local v37           #scale_min:F
+    .end local v38           #scale_step:F
+    :cond_140
+    move-object/from16 v0, p1
+
+    move-object/from16 v1, v32
+
+    invoke-virtual {v0, v1}, Landroid/widget/ImageView;->setImageBitmap(Landroid/graphics/Bitmap;)V
+
+    goto/16 :goto_8
+
+    .line 169
+    .end local v2           #canvas:Landroid/graphics/Canvas;
+    .end local v7           #paint:Landroid/graphics/Paint;
+    .end local v11           #buttonWidth:I
+    .end local v24           #bHasGlowlight:Z
+    .end local v25           #buttonCount:I
+    .end local v26           #buttonHeight:I
+    .end local v30           #iconOffsetY:I
+    .end local v31           #labelOffsetY:I
+    .end local v32           #newBitmap:Landroid/graphics/Bitmap;
+    :cond_149
+    const/16 v24, 0x0
+
+    goto/16 :goto_55
+
+    .line 170
+    .restart local v24       #bHasGlowlight:Z
+    :cond_14d
+    const/16 v25, 0x5
+
+    goto/16 :goto_59
+
+    .line 216
+    .restart local v2       #canvas:Landroid/graphics/Canvas;
+    .restart local v7       #paint:Landroid/graphics/Paint;
+    .restart local v8       #layout:Landroid/text/StaticLayout;
+    .restart local v10       #tpaint:Landroid/text/TextPaint;
+    .restart local v11       #buttonWidth:I
+    .restart local v25       #buttonCount:I
+    .restart local v26       #buttonHeight:I
+    .restart local v30       #iconOffsetY:I
+    .restart local v31       #labelOffsetY:I
+    .restart local v32       #newBitmap:Landroid/graphics/Bitmap;
+    .restart local v36       #scale:F
+    .restart local v37       #scale_min:F
+    .restart local v38       #scale_step:F
+    :cond_151
+    sub-float v36, v36, v38
+
+    .line 217
+    move/from16 v0, v36
+
+    invoke-virtual {v10, v0}, Landroid/text/TextPaint;->setTextScaleX(F)V
+
+    .line 218
+    new-instance v8, Landroid/text/StaticLayout;
+
+    .end local v8           #layout:Landroid/text/StaticLayout;
+    sget-object v12, Landroid/text/Layout$Alignment;->ALIGN_CENTER:Landroid/text/Layout$Alignment;
+
+    const v13, 0x3f4ccccd
+
+    const/4 v14, 0x0
+
+    const/4 v15, 0x1
+
+    invoke-direct/range {v8 .. v15}, Landroid/text/StaticLayout;-><init>(Ljava/lang/CharSequence;Landroid/text/TextPaint;ILandroid/text/Layout$Alignment;FFZ)V
+
+    .restart local v8       #layout:Landroid/text/StaticLayout;
+    goto :goto_101
+.end method
diff --git a/services/com/android/server/status/StatusBarService.smali b/services/com/android/server/status/StatusBarService.smali
index d143ae8..b6ef816 100644
--- a/services/com/android/server/status/StatusBarService.smali
+++ b/services/com/android/server/status/StatusBarService.smali
@@ -2114,6 +2114,24 @@
     .parameter "action"
 
     .prologue
+
+### Mod Start
+###
+###   Always show back and menu buttons in statusbar
+###
+    iget-object v0, p0, Lcom/android/server/status/StatusBarService;->mContext:Landroid/content/Context;
+    invoke-static {v0}, Lcom/android/server/status/ModUtils;->alwaysShowStatusIcons(Landroid/content/Context;)Z
+
+    move-result v0
+    if-eqz v0, :cond_NoMod
+
+    const/4 v1, 0x0
+    move v0, v1
+	goto :goto_4
+
+    :cond_NoMod
+### Mod End
+
     .line 1917
     if-nez p1, :cond_13
 
@@ -4523,6 +4541,23 @@
     .local v1, id:I
     iget-object v5, p0, Lcom/android/server/status/StatusBarService;->mContext:Landroid/content/Context;
 
+### Mod Start
+###
+### Override status bar buttons
+### This should run near the start of onQuicknavButtonClick()
+### after getId() is read into v1 and context is read into v5
+###
+### if ( ModUtils.OnButtonClick( StatusBarService.mContext, buttonId ) )
+###   return;
+
+    invoke-static {v5, v1}, Lcom/android/server/status/ModUtils;->OnButtonClick(Landroid/content/Context;I)Z
+
+    move-result v0
+    if-eqz v0, :cond_mod1
+    return-void
+    :cond_mod1
+### Mod End
+
     const-string v6, "statusbar"
 
     invoke-virtual {v5, v6}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
